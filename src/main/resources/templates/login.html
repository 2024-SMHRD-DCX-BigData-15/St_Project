<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0" />
  <link rel="stylesheet" href="/css/login.css" />
</head>
<body style="margin: 0">
  <div class="container-center-horizontal">
    <div class="sign-in-screen screen">
      <div class="main-dashboard">
        <div class="inputs">
          <div class="title">
            <div class="text-21">ë¡œê·¸ì¸</div>
          </div>

          <form action="login.do" method="post" id="loginForm" onsubmit="return handleLogin()">
            <div class="input-group">
              <label for="userId" class="text-1">ì•„ì´ë””</label>
              <input type="text" id="userId" name="id" class="input-field-text" placeholder="ì•„ì´ë””ë¥¼ ì…ë ¥í•˜ì„¸ìš”" required />
            </div>

            <div class="input-group">
              <label for="password" class="text-1">ë¹„ë°€ë²ˆí˜¸</label>
              <input type="password" id="password" name="pw" class="input-field-text" placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”" required />
            </div>

            <!-- ğŸ”¹ ìë™ ë¡œê·¸ì¸ ìŠ¤ìœ„ì¹˜ ì¶”ê°€ -->
            <div class="remember-me">
              <label class="switch-base">
                <input type="checkbox" id="autoLoginToggle" name="autoLogin" />
                <div class="ellipse-1"></div>
              </label>
              <div class="text-15"> ìë™ ë¡œê·¸ì¸</div>
            </div>

            <div class="button-base_login">
              <button type="submit" id="loginBtn" class="button-body">
                <div class="text">ë¡œê·¸ì¸</div>
              </button>
            </div>
          </form>

          <div class="text-14">
            ê³„ì •ì´ ì—†ìœ¼ì‹ ê°€ìš”? <a href="register" class="signup-link">íšŒì›ê°€ì…</a> <br>
            30ì¼ ë‚´ íƒˆí‡´í•œ ê³„ì •ì´ ìˆìœ¼ì‹ ê°€ìš”? <a href="relogin" class="signup-link">ê³„ì •ë³µêµ¬</a>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
  /**
   * ğŸ”¹ ë¡œê·¸ì¸ ì‹œ ì„œë²„ë¡œ í‰ë¬¸ ë¹„ë°€ë²ˆí˜¸ ì „ì†¡ (ì„œë²„ì—ì„œ SHA-256 ì•”í˜¸í™”)
   * - ìë™ ë¡œê·¸ì¸ ì„ íƒ ì‹œ ì¿ í‚¤ì— ID/PW ì €ì¥ (í‰ë¬¸ ë¹„ë°€ë²ˆí˜¸)
   */
  async function handleLogin() {
      let userId = document.getElementById("userId").value;
      let password = document.getElementById("password").value;
      let autoLogin = document.getElementById("autoLoginToggle").checked; // ìë™ ë¡œê·¸ì¸ ì²´í¬ ì—¬ë¶€

      if (userId === "" || password === "") {
          alert("ì•„ì´ë””ì™€ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.");
          return false;
      }

      console.log("ğŸ”¹ ë¡œê·¸ì¸ ì‹œë„ - ID:", userId);

      // ğŸ”¹ ìë™ ë¡œê·¸ì¸ ì²´í¬ ì‹œ í‰ë¬¸ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì¿ í‚¤ì— ì €ì¥
      if (autoLogin) {
          setCookie("autoLoginId", userId, 7);  // 7ì¼ ë™ì•ˆ ìœ ì§€
          setCookie("autoLoginPw", password, 7);
      } else {
          deleteCookie("autoLoginId");
          deleteCookie("autoLoginPw");
      }

      return true; // í¼ ì œì¶œ ì§„í–‰
  }

  /**
   * ğŸ”¹ ì¿ í‚¤ ì„¤ì • í•¨ìˆ˜ (SameSite ë° Secure ì†ì„± ì¶”ê°€)
   */
  function setCookie(name, value, days) {
      let date = new Date();
      date.setTime(date.getTime() + days * 24 * 60 * 60 * 1000);
      document.cookie = `${name}=${value};expires=${date.toUTCString()};path=/;SameSite=Strict;Secure`;
  }

  /**
   * ğŸ”¹ ì¿ í‚¤ ê°€ì ¸ì˜¤ê¸° í•¨ìˆ˜
   */
  function getCookie(name) {
      let cookies = document.cookie.split("; ");
      for (let cookie of cookies) {
          let [key, value] = cookie.split("=");
          if (key === name) return value;
      }
      return null;
  }

  /**
   * ğŸ”¹ ì¿ í‚¤ ì‚­ì œ í•¨ìˆ˜
   */
  function deleteCookie(name) {
      document.cookie = `${name}=;expires=Thu, 01 Jan 1970 00:00:00 UTC;path=/;SameSite=Strict;Secure`;
  }

  /**
   * ğŸ”¹ ìë™ ë¡œê·¸ì¸ í™•ì¸ ë° ì ìš©
   */
  window.onload = async function () {
      let savedId = getCookie("autoLoginId");
      let savedPw = getCookie("autoLoginPw"); // âœ… í‰ë¬¸ ë¹„ë°€ë²ˆí˜¸ ê°€ì ¸ì˜¤ê¸° (ì•”í˜¸í™” ì•ˆ í•¨)

      console.log("ğŸš€ ìë™ ë¡œê·¸ì¸ ì²´í¬ - ID:", savedId);

      if (savedId && savedPw) {
          console.log("ğŸš€ ìë™ ë¡œê·¸ì¸ ì‹œë„...");

          let response = await fetch("/api/auto-login", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ id: savedId, pw: savedPw }) // âœ… í‰ë¬¸ ë¹„ë°€ë²ˆí˜¸ ê·¸ëŒ€ë¡œ ì „ì†¡
          });

          let result = await response.text();
          if (result === "SUCCESS") {
              console.log("âœ… ìë™ ë¡œê·¸ì¸ ì„±ê³µ");
              alert("ìë™ ë¡œê·¸ì¸ ì™„ë£Œ!");
              window.location.href = "/maindashboard";
          } else {
              console.log("âŒ ìë™ ë¡œê·¸ì¸ ì‹¤íŒ¨");
              alert("ìë™ ë¡œê·¸ì¸ ì‹¤íŒ¨! ë‹¤ì‹œ ë¡œê·¸ì¸í•˜ì„¸ìš”.");
              deleteCookie("autoLoginId");
              deleteCookie("autoLoginPw");
          }
      }
  };
  
  /**
   * ìŠ¤ìœ„ì¹˜ ë°°ê²½ìƒ‰ ë³€ê²½
   */
  document.addEventListener("DOMContentLoaded", function () {
      const toggle = document.getElementById("autoLoginToggle");
      const switchBase = document.querySelector(".switch-base");

      // ì´ˆê¸° ìƒíƒœ ì„¤ì •
      if (toggle.checked) {
          switchBase.style.backgroundColor = "#0075ff";
      } else {
          switchBase.style.backgroundColor = "#ccc";
      }

      // ì²´í¬ ìƒíƒœ ë³€ê²½ ì‹œ ë°°ê²½ìƒ‰ ì—…ë°ì´íŠ¸
      toggle.addEventListener("change", function () {
          if (toggle.checked) {
              switchBase.style.backgroundColor = "#0075ff";
          } else {
              switchBase.style.backgroundColor = "#ccc";
          }
      });
  });
  </script>
</body>
</html>
