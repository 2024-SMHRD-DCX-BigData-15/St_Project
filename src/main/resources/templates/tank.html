<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>수조 추가</title>
    <link rel="stylesheet" href="/css/tank.css">
</head>
<body>
    <div class="wrapper">
        <!-- 사이드바 -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h2>메뉴</h2>
            </div>
            <ul class="sidebar-menu">
                <li><a href="#">홈</a></li>
                <li><a href="#">대시보드</a></li>
                <li><a href="#">설정</a></li>
            </ul>
        </div>

        <!-- 햄버거 메뉴 -->
        <div class="hamburger-menu" id="hamburger-menu">
            <div class="bar"></div>
            <div class="bar"></div>
            <div class="bar"></div>
        </div>

        <!-- 메인 콘텐츠 -->
        <main class="main-content">
            <header class="header">
                <h1 class="page-title">수조 추가</h1>
            </header>

            <!-- 수조 추가 폼 -->
            <section class="tank-form-container">
                <form class="tank-form">
                    <div class="form-group">
                        <label for="tank-diameter">수조 직경 (m)</label>
                        <input type="number" id="tank-diameter" name="tank_width" min="0">
                    </div>

                    <div class="form-group">
                        <label for="tank-height">수조 높이 (m)</label>
                        <input type="number" id="tank-height" name="tank_height" min="0">
                    </div>

                    <div class="form-group">
                        <label for="tank-location">수조 위치</label>
                        <input type="text" id="tank-location" name="tank_location">
                    </div>

                    <div class="form-group">
                        <label for="species">품종</label>
                        <input type="text" id="species" name="fish_type">
                    </div>

                    <div class="form-group">
                        <label for="start-date">사육 개시일</label>
                        <input type="date" id="start-date" name="started_at">
                    </div>

                    <div class="form-actions">
                        <button type="submit" class="add-btn">추가</button>
                        <button type="reset" class="cancel-btn">취소</button>
                    </div>
                </form>
            </section>

        </main>
    </div>

    <script>
        document.getElementById('hamburger-menu').addEventListener('click', function() {
            document.getElementById('sidebar').classList.toggle('open');
            this.classList.toggle('open');
        });
        
        /**
         * 🔹 수조 추가 버튼 클릭 시 데이터 저장 후 대시보드로 이동
         */
         document.querySelector('.tank-form').addEventListener('submit', async function(event) {
             event.preventDefault(); // 기본 제출 방지

             let userId = `[[${session.loginUser?.userId}]]`; // ✅ 세션에서 사용자 ID 가져오기
             let tankWidth = document.getElementById('tank-diameter').value;
             let tankHeight = document.getElementById('tank-height').value;
             let tankLocation = document.getElementById('tank-location').value;
             let fishType = document.getElementById('species').value;
             let startedAt = document.getElementById('start-date').value;

             // 🔹 콘솔 로그로 입력값 확인
             console.log("🚀 수조 추가 요청:");
             console.log("📌 사용자 ID:", userId);
             console.log("📌 직경:", tankWidth, "m");
             console.log("📌 높이:", tankHeight, "m");
             console.log("📌 위치:", tankLocation);
             console.log("📌 품종:", fishType);
             console.log("📌 개시일:", startedAt);

             let requestData = {
                 userId: userId,
                 tankWidth: parseFloat(tankWidth),
                 tankHeight: parseFloat(tankHeight),
                 tankLocation: tankLocation,
                 fishType: fishType,
                 startedAt: startedAt
             };

             try {
                 let response = await fetch("/tank/add", {
                     method: "POST",
                     headers: { "Content-Type": "application/json" }, // ✅ JSON 형식으로 전송
                     body: JSON.stringify(requestData)
                 });

                 console.log("📡 서버 응답 상태 코드:", response.status);

                 if (response.ok) {
                     alert("✅ 수조 추가 완료!");
                     console.log("✅ 서버 응답: 수조 추가 성공");
                     window.location.href = "/maindashboard"; // 대시보드로 이동
                 } else {
                     let errorText = await response.text();
                     alert("❌ 수조 추가 실패!");
                     console.error("❌ 서버 응답:", errorText);
                 }
             } catch (error) {
                 console.error("🚨 서버 요청 중 오류 발생:", error);
                 alert("❌ 서버 오류 발생!");
             }
         });
    </script>
</body>
</html>
