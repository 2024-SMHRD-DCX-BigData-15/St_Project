<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìˆ˜ì¡° ì¶”ê°€</title>
    <link rel="stylesheet" href="/css/tank.css">
</head>
<body>
    <div class="wrapper">
        <!-- ì‚¬ì´ë“œë°” -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h2>ë©”ë‰´</h2>
            </div>
            <ul class="sidebar-menu">
                <li><a href="#">í™ˆ</a></li>
                <li><a href="#">ëŒ€ì‹œë³´ë“œ</a></li>
                <li><a href="#">ì„¤ì •</a></li>
            </ul>
        </div>

        <!-- í–„ë²„ê±° ë©”ë‰´ -->
        <div class="hamburger-menu" id="hamburger-menu">
            <div class="bar"></div>
            <div class="bar"></div>
            <div class="bar"></div>
        </div>

        <!-- ë©”ì¸ ì½˜í…ì¸  -->
        <main class="main-content">
            <header class="header">
                <h1 class="page-title">ìˆ˜ì¡° ì¶”ê°€</h1>
            </header>

            <!-- ìˆ˜ì¡° ì¶”ê°€ í¼ -->
            <section class="tank-form-container">
                <form class="tank-form">
                    <div class="form-group">
                        <label for="tank-diameter">ìˆ˜ì¡° ì§ê²½ (m)</label>
                        <input type="number" id="tank-diameter" name="tank_width" min="0">
                    </div>

                    <div class="form-group">
                        <label for="tank-height">ìˆ˜ì¡° ë†’ì´ (m)</label>
                        <input type="number" id="tank-height" name="tank_height" min="0">
                    </div>

                    <div class="form-group">
                        <label for="tank-location">ìˆ˜ì¡° ìœ„ì¹˜</label>
                        <input type="text" id="tank-location" name="tank_location">
                    </div>

                    <div class="form-group">
                        <label for="species">í’ˆì¢…</label>
                        <input type="text" id="species" name="fish_type">
                    </div>

                    <div class="form-group">
                        <label for="start-date">ì‚¬ìœ¡ ê°œì‹œì¼</label>
                        <input type="date" id="start-date" name="started_at">
                    </div>

                    <div class="form-actions">
                        <button type="submit" class="add-btn">ì¶”ê°€</button>
                        <button type="reset" class="cancel-btn">ì·¨ì†Œ</button>
                    </div>
                </form>
            </section>

        </main>
    </div>

    <script>
        document.getElementById('hamburger-menu').addEventListener('click', function() {
            document.getElementById('sidebar').classList.toggle('open');
            this.classList.toggle('open');
        });
        
        /**
         * ğŸ”¹ ìˆ˜ì¡° ì¶”ê°€ ë²„íŠ¼ í´ë¦­ ì‹œ ë°ì´í„° ì €ì¥ í›„ ëŒ€ì‹œë³´ë“œë¡œ ì´ë™
         */
         document.querySelector('.tank-form').addEventListener('submit', async function(event) {
             event.preventDefault(); // ê¸°ë³¸ ì œì¶œ ë°©ì§€

             let userId = `[[${session.loginUser?.userId}]]`; // âœ… ì„¸ì…˜ì—ì„œ ì‚¬ìš©ì ID ê°€ì ¸ì˜¤ê¸°
             let tankWidth = document.getElementById('tank-diameter').value;
             let tankHeight = document.getElementById('tank-height').value;
             let tankLocation = document.getElementById('tank-location').value;
             let fishType = document.getElementById('species').value;
             let startedAt = document.getElementById('start-date').value;

             // ğŸ”¹ ì½˜ì†” ë¡œê·¸ë¡œ ì…ë ¥ê°’ í™•ì¸
             console.log("ğŸš€ ìˆ˜ì¡° ì¶”ê°€ ìš”ì²­:");
             console.log("ğŸ“Œ ì‚¬ìš©ì ID:", userId);
             console.log("ğŸ“Œ ì§ê²½:", tankWidth, "m");
             console.log("ğŸ“Œ ë†’ì´:", tankHeight, "m");
             console.log("ğŸ“Œ ìœ„ì¹˜:", tankLocation);
             console.log("ğŸ“Œ í’ˆì¢…:", fishType);
             console.log("ğŸ“Œ ê°œì‹œì¼:", startedAt);

             let requestData = {
                 userId: userId,
                 tankWidth: parseFloat(tankWidth),
                 tankHeight: parseFloat(tankHeight),
                 tankLocation: tankLocation,
                 fishType: fishType,
                 startedAt: startedAt
             };

             try {
                 let response = await fetch("/tank/add", {
                     method: "POST",
                     headers: { "Content-Type": "application/json" }, // âœ… JSON í˜•ì‹ìœ¼ë¡œ ì „ì†¡
                     body: JSON.stringify(requestData)
                 });

                 console.log("ğŸ“¡ ì„œë²„ ì‘ë‹µ ìƒíƒœ ì½”ë“œ:", response.status);

                 if (response.ok) {
                     alert("âœ… ìˆ˜ì¡° ì¶”ê°€ ì™„ë£Œ!");
                     console.log("âœ… ì„œë²„ ì‘ë‹µ: ìˆ˜ì¡° ì¶”ê°€ ì„±ê³µ");
                     window.location.href = "/maindashboard"; // ëŒ€ì‹œë³´ë“œë¡œ ì´ë™
                 } else {
                     let errorText = await response.text();
                     alert("âŒ ìˆ˜ì¡° ì¶”ê°€ ì‹¤íŒ¨!");
                     console.error("âŒ ì„œë²„ ì‘ë‹µ:", errorText);
                 }
             } catch (error) {
                 console.error("ğŸš¨ ì„œë²„ ìš”ì²­ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:", error);
                 alert("âŒ ì„œë²„ ì˜¤ë¥˜ ë°œìƒ!");
             }
         });
    </script>
</body>
</html>
